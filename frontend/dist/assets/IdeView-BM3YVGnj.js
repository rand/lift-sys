import{r as c,j as e}from"./vendor-react-Cn3fHe9B.js";import{b as q}from"./vendor-query-CJnMiGqQ.js";import{C as y,a as R,b as B,g as P,c as v,B as x,S as N,f as C}from"./index-CA5AEePF.js";import{B as p}from"./badge-DVFEUDXu.js";import{u as M,S as _}from"./useProgressStream-Befj3wwJ.js";import"./vendor-radix-ERXSFEfG.js";import"./vendor-utils-DARsLm--.js";import"./vendor-icons-Bamum9f2.js";function H(){const{data:n}=q({queryKey:["plan"],queryFn:async()=>{var s;try{return(await C.get("/plan")).data}catch(a){if(((s=a==null?void 0:a.response)==null?void 0:s.status)===404)return null;throw a}},staleTime:1e4}),{events:h,status:$,clear:b}=M(),[r,w]=c.useState(null),[l,S]=c.useState(!1),o=c.useRef(new Set),[f,m]=c.useState([]),k=async()=>{if(!(n!=null&&n.ir))return;const{data:s}=await C.post("/forward",{ir:n.ir});w(s),o.current.clear(),m([])},j=c.useMemo(()=>(r==null?void 0:r.request_payload.prompt.constraints)??[],[r]),g=c.useMemo(()=>h.filter(s=>s.scope==="forward"),[h]);c.useEffect(()=>{l||m(s=>{const a=[...s];for(const t of g){const i=`${t.timestamp}-${t.stage}-${t.status}-${t.message}`;if(!o.current.has(i)){o.current.add(i);const d=t.stage??t.type,I=t.status?` (${t.status})`:"";a.push(`${d}${I}: ${t.message??""}`.trim())}}return((r==null?void 0:r.request_payload.stream)??[]).forEach((t,i)=>{const d=`token-${i}-${t}`;o.current.has(d)||(o.current.add(d),a.push(`token â–¸ ${t}`))}),a.slice(-200)})},[g,r,l]);const E=l?"Resume":"Pause";return e.jsx("div",{className:"space-y-6",children:e.jsxs(y,{children:[e.jsxs(R,{children:[e.jsx(B,{children:"Interactive IDE"}),e.jsx(P,{children:"Compile the IR into generation constraints and preview payloads."})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-3 flex-wrap items-center",children:[e.jsx(x,{onClick:k,disabled:!(n!=null&&n.ir),children:n!=null&&n.ir?"Generate Constraints":"Load IR to continue"}),e.jsxs(x,{variant:"ghost",onClick:()=>S(s=>!s),children:[E," Console"]}),e.jsx(x,{variant:"ghost",onClick:()=>{b(),o.current.clear(),m([])},children:"Clear Console"}),e.jsxs(p,{variant:"info",children:["Stream: ",$]})]}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Constraint Inspector"}),j.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Run forward mode to populate constraints."}):e.jsx("ul",{className:"space-y-3",children:j.map((s,a)=>e.jsx("li",{children:e.jsx(y,{className:"bg-card/60",children:e.jsxs(v,{className:"pt-6 space-y-2",children:[e.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[e.jsx(p,{variant:"secondary",children:s.name}),e.jsx("span",{className:"font-semibold text-sm",children:s.value})]}),s.metadata&&Object.keys(s.metadata).length>0&&e.jsx("dl",{className:"space-y-1 text-sm",children:Object.entries(s.metadata).map(([u,t])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("dt",{className:"capitalize text-muted-foreground",children:[u,":"]}),e.jsx("dd",{children:t})]},u))})]})})},`${s.name}-${a}`))})]}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Execution Console"}),(r==null?void 0:r.request_payload.telemetry)&&e.jsxs(p,{variant:"secondary",children:[r.request_payload.telemetry.length," telemetry events"]})]}),e.jsxs(_,{className:"h-[280px] bg-slate-950 text-slate-200 p-4 rounded-lg",role:"log","aria-live":l?"off":"polite",children:[f.length===0&&e.jsx("span",{className:"text-muted-foreground",children:"No runtime output yet."}),e.jsx("div",{className:"space-y-1",children:f.map((s,a)=>e.jsx("div",{className:"font-mono text-sm",children:s},`${s}-${a}`))})]})]})]})]})})}export{H as IdeView};
